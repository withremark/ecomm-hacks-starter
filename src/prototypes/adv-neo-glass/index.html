<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neo Glass - Product Placement Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Sora:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
      color: #ffffff;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* Animated background gradient */
    body::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 50% 50%, rgba(0, 212, 255, 0.03) 0%, transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(124, 58, 237, 0.03) 0%, transparent 50%);
      animation: gradientShift 30s infinite alternate;
      pointer-events: none;
    }

    @keyframes gradientShift {
      0% { transform: translate(0, 0); }
      100% { transform: translate(10%, 10%); }
    }

    /* Fade in animation */
    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    body {
      animation: fadeInScale 0.6s ease-out;
    }

    .container {
      display: flex;
      height: 100vh;
      width: 100%;
      gap: 24px;
      padding: 24px;
      position: relative;
      z-index: 1;
    }

    /* Glass panel base styles */
    .glass-panel {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 24px;
      display: flex;
      flex-direction: column;
    }

    /* Typography */
    h2 {
      font-family: 'Sora', sans-serif;
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 20px;
      color: rgba(255, 255, 255, 0.9);
      background: linear-gradient(135deg, #00d4ff, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* LEFT PANEL - Collection */
    .panel-collection {
      width: 260px;
    }

    .featured-product {
      width: 100%;
      aspect-ratio: 1;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 16px;
      position: relative;
    }

    .featured-product img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .featured-product::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, transparent 50%, rgba(0, 0, 0, 0.3) 100%);
      pointer-events: none;
    }

    .featured-info {
      position: absolute;
      bottom: 16px;
      left: 16px;
      right: 16px;
      z-index: 1;
    }

    .featured-brand {
      font-family: 'Sora', sans-serif;
      font-size: 18px;
      font-weight: 800;
      letter-spacing: 1px;
      margin-bottom: 2px;
    }

    .featured-name {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 300;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 16px;
      flex: 1;
      align-content: start;
    }

    .product-tile {
      width: 100%;
      aspect-ratio: 1;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .product-tile img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .product-tile:hover {
      border-color: #00d4ff;
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
    }

    .product-tile.selected {
      border-color: #00d4ff;
      border-width: 2px;
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.4),
                  inset 0 0 20px rgba(0, 212, 255, 0.1);
    }

    .product-tile.selected::after {
      content: '✓';
      position: absolute;
      top: 4px;
      right: 4px;
      background: linear-gradient(135deg, #00d4ff, #7c3aed);
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
    }

    .selection-count {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      text-align: center;
      padding: 12px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 8px;
    }

    /* CENTER PANEL - Targeting */
    .panel-targeting {
      width: 340px;
    }

    .form-group {
      margin-bottom: 18px;
    }

    .form-group label {
      display: block;
      font-size: 10px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
    }

    .tag-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag-chip {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.7);
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .tag-chip:hover {
      border-color: #00d4ff;
      color: #00d4ff;
      transform: translateY(-1px);
    }

    .tag-chip.selected {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(124, 58, 237, 0.2));
      border: 1px solid rgba(0, 212, 255, 0.4);
      color: #00d4ff;
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
    }

    .form-group textarea {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      font-size: 12px;
      color: #ffffff;
      font-family: inherit;
      resize: none;
      transition: all 0.3s;
      height: 80px;
    }

    .form-group textarea::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }

    .form-group textarea:focus {
      outline: none;
      border-color: #00d4ff;
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
    }

    .glass-button {
      width: 100%;
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(124, 58, 237, 0.2));
      border: 1px solid rgba(0, 212, 255, 0.3);
      color: #fff;
      padding: 14px 24px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .glass-button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
      border-radius: 50%;
    }

    .glass-button:hover:not(:disabled)::before {
      width: 300px;
      height: 300px;
    }

    .glass-button:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.4), rgba(124, 58, 237, 0.4));
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
      transform: translateY(-2px);
    }

    .glass-button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .glass-button.secondary {
      background: linear-gradient(135deg, rgba(255, 0, 110, 0.2), rgba(124, 58, 237, 0.2));
      border-color: rgba(255, 0, 110, 0.3);
    }

    .glass-button.secondary:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(255, 0, 110, 0.4), rgba(124, 58, 237, 0.4));
      box-shadow: 0 0 30px rgba(255, 0, 110, 0.3);
    }

    .button-group {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* RIGHT PANEL - Placements */
    .panel-placements {
      flex: 1;
      overflow-y: auto;
    }

    .panel-placements::-webkit-scrollbar {
      width: 8px;
    }

    .panel-placements::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }

    .panel-placements::-webkit-scrollbar-thumb {
      background: rgba(0, 212, 255, 0.3);
      border-radius: 4px;
    }

    .panel-placements::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 212, 255, 0.5);
    }

    .placements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 16px;
    }

    .placement-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .placement-card:hover {
      transform: translateY(-4px);
      border-color: #00d4ff;
      box-shadow: 0 8px 32px rgba(0, 212, 255, 0.2);
    }

    .placement-card.high-match {
      animation: pulseGlow 3s ease-in-out infinite;
    }

    @keyframes pulseGlow {
      0%, 100% {
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
      }
      50% {
        box-shadow: 0 0 30px rgba(0, 212, 255, 0.4);
      }
    }

    .placement-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .placement-card-info {
      padding: 12px;
    }

    .placement-match {
      font-family: 'Sora', sans-serif;
      font-size: 24px;
      font-weight: 800;
      background: linear-gradient(135deg, #00d4ff, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 4px;
    }

    .placement-name {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .placements-summary {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      text-align: center;
      padding: 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      margin-top: 16px;
    }

    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: rgba(255, 255, 255, 0.4);
    }

    .empty-state h3 {
      font-family: 'Sora', sans-serif;
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
      color: rgba(255, 255, 255, 0.5);
    }

    .empty-state p {
      font-size: 14px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 24px;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: rgba(15, 15, 26, 0.95);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      max-width: 1200px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes modalSlideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #00d4ff, transparent);
      animation: borderGlow 3s ease-in-out infinite;
    }

    @keyframes borderGlow {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(124, 58, 237, 0.2));
      border: 1px solid rgba(0, 212, 255, 0.3);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      z-index: 10;
    }

    .modal-close:hover {
      background: linear-gradient(135deg, rgba(0, 212, 255, 0.4), rgba(124, 58, 237, 0.4));
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 50px 40px 40px;
    }

    .modal-title {
      font-family: 'Sora', sans-serif;
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 30px;
      background: linear-gradient(135deg, #00d4ff, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    .comparison-item h3 {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      font-weight: 600;
    }

    .comparison-item img {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .loading {
      text-align: center;
      padding: 40px 20px;
      color: rgba(255, 255, 255, 0.5);
      font-size: 14px;
    }

    .loading::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- LEFT PANEL: Collection -->
    <div class="panel-collection glass-panel">
      <h2>COLLECTION</h2>

      <div class="featured-product" id="featuredProduct">
        <img src="/prototype-assets/products/prada-1.jpg" alt="Featured Product">
        <div class="featured-info">
          <div class="featured-brand">PRADA</div>
          <div class="featured-name">Galleria Bag</div>
        </div>
      </div>

      <div class="products-grid" id="productsGrid"></div>

      <div class="selection-count">
        Selected: <span id="selectionCount">0</span> products
      </div>
    </div>

    <!-- CENTER PANEL: Targeting -->
    <div class="panel-targeting glass-panel">
      <h2>TARGETING</h2>

      <div class="form-group">
        <label>Age Range</label>
        <div class="tag-chips" id="ageChips"></div>
      </div>

      <div class="form-group">
        <label>Interests</label>
        <div class="tag-chips" id="interestChips"></div>
      </div>

      <div class="form-group">
        <label>Semantic Query</label>
        <textarea id="semanticQuery" placeholder="Describe ideal placement context..."></textarea>
      </div>

      <div class="button-group">
        <button class="glass-button" id="generateBtn">
          <span style="position: relative; z-index: 1;">▶ Generate</span>
        </button>
        <button class="glass-button secondary" id="deployBtn" disabled>
          <span style="position: relative; z-index: 1;">Deploy →</span>
        </button>
      </div>
    </div>

    <!-- RIGHT PANEL: Placements -->
    <div class="panel-placements glass-panel">
      <h2>PLACEMENTS</h2>
      <div id="placementsContainer">
        <div class="empty-state">
          <h3>No placements generated</h3>
          <p>Select products and targeting criteria, then click Generate</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <button class="modal-close" id="modalClose">×</button>
      <div class="modal-body">
        <h2 class="modal-title">Placement Preview</h2>
        <div class="comparison-grid" id="comparisonGrid"></div>
      </div>
    </div>
  </div>

  <script>
    // Product Data - Load from local files
    const PRODUCTS = [
      { id: 'prada-1', brand: 'PRADA', name: 'Galleria', img: '/prototype-assets/products/prada-1.jpg' },
      { id: 'prada-2', brand: 'PRADA', name: 'Saffiano', img: '/prototype-assets/products/prada-2.jpg' },
      { id: 'prada-3', brand: 'PRADA', name: 'Re-Edition', img: '/prototype-assets/products/prada-3.jpg' },
      { id: 'lv-1', brand: 'LOUIS VUITTON', name: 'Neverfull', img: '/prototype-assets/products/lv-1.jpg' },
      { id: 'lv-2', brand: 'LOUIS VUITTON', name: 'Speedy', img: '/prototype-assets/products/lv-2.jpg' },
      { id: 'lv-3', brand: 'LOUIS VUITTON', name: 'Pochette', img: '/prototype-assets/products/lv-3.jpg' },
      { id: 'acne-1', brand: 'ACNE STUDIOS', name: 'Musubi', img: '/prototype-assets/products/acne-1.jpg' },
      { id: 'acne-2', brand: 'ACNE STUDIOS', name: 'Baker', img: '/prototype-assets/products/acne-2.jpg' },
      { id: 'acne-3', brand: 'ACNE STUDIOS', name: 'Buckle', img: '/prototype-assets/products/acne-3.jpg' }
    ];

    // Aesthetic Data - Load from local files
    const AESTHETICS = [
      { id: 'cafe-table', name: 'Café Table', img: '/prototype-assets/aesthetics/cafe-table.jpg', match: 94 },
      { id: 'boutique', name: 'Boutique', img: '/prototype-assets/aesthetics/boutique.jpg', match: 91 },
      { id: 'tuileries', name: 'Tuileries', img: '/prototype-assets/aesthetics/tuileries.jpg', match: 88 },
      { id: 'artist-studio', name: 'Artist Studio', img: '/prototype-assets/aesthetics/artist-studio.jpg', match: 85 },
      { id: 'palais-royal', name: 'Palais Royal', img: '/prototype-assets/aesthetics/palais-royal.jpg', match: 82 },
      { id: 'rooftop', name: 'Rooftop', img: '/prototype-assets/aesthetics/rooftop.jpg', match: 79 }
    ];

    const INTERESTS = ['Fashion', 'Home', 'Luxury', 'Travel', 'Art', 'Design', 'Lifestyle', 'Minimal'];
    const AGE_RANGES = ['18-24', '25-34', '35-44', '45+'];

    // State
    let selectedProducts = new Set();
    let selectedInterests = new Set(['Fashion', 'Luxury']);
    let selectedAges = new Set(['25-34', '35-44']);
    let generatedPlacements = [];

    // Initialize
    function init() {
      renderProducts();
      renderAges();
      renderInterests();
      setupEventListeners();
    }

    // Render Products
    function renderProducts() {
      const grid = document.getElementById('productsGrid');
      grid.innerHTML = PRODUCTS.map(product => `
        <div class="product-tile" data-id="${product.id}" title="${product.brand} ${product.name}">
          <img src="${product.img}" alt="${product.brand} ${product.name}" loading="lazy">
        </div>
      `).join('');

      grid.querySelectorAll('.product-tile').forEach(tile => {
        tile.addEventListener('click', () => toggleProduct(tile.dataset.id));
      });
    }

    // Render Ages
    function renderAges() {
      const container = document.getElementById('ageChips');
      container.innerHTML = AGE_RANGES.map(age => `
        <div class="tag-chip ${selectedAges.has(age) ? 'selected' : ''}" data-age="${age}">${age}</div>
      `).join('');

      container.querySelectorAll('.tag-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          const age = chip.dataset.age;
          if (selectedAges.has(age)) {
            selectedAges.delete(age);
            chip.classList.remove('selected');
          } else {
            selectedAges.add(age);
            chip.classList.add('selected');
          }
        });
      });
    }

    // Render Interests
    function renderInterests() {
      const container = document.getElementById('interestChips');
      container.innerHTML = INTERESTS.map(interest => `
        <div class="tag-chip ${selectedInterests.has(interest) ? 'selected' : ''}" data-interest="${interest}">${interest}</div>
      `).join('');

      container.querySelectorAll('.tag-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          const interest = chip.dataset.interest;
          if (selectedInterests.has(interest)) {
            selectedInterests.delete(interest);
            chip.classList.remove('selected');
          } else {
            selectedInterests.add(interest);
            chip.classList.add('selected');
          }
        });
      });
    }

    // Toggle Product Selection
    function toggleProduct(id) {
      const tile = document.querySelector(`[data-id="${id}"]`);
      const product = PRODUCTS.find(p => p.id === id);

      if (selectedProducts.has(id)) {
        selectedProducts.delete(id);
        tile.classList.remove('selected');
      } else {
        selectedProducts.add(id);
        tile.classList.add('selected');

        // Update featured product
        const featured = document.getElementById('featuredProduct');
        featured.querySelector('img').src = product.img;
        featured.querySelector('.featured-brand').textContent = product.brand;
        featured.querySelector('.featured-name').textContent = product.name;
      }
      updateSelectionCount();
    }

    // Update Selection Count
    function updateSelectionCount() {
      document.getElementById('selectionCount').textContent = selectedProducts.size;
    }

    // Generate Placements
    async function generate() {
      if (selectedProducts.size === 0) {
        alert('Please select at least one product');
        return;
      }

      const generateBtn = document.getElementById('generateBtn');
      const placementsContainer = document.getElementById('placementsContainer');

      const originalText = generateBtn.querySelector('span').textContent;
      generateBtn.disabled = true;
      generateBtn.querySelector('span').textContent = 'Generating...';

      placementsContainer.innerHTML = '<div class="loading">Generating placements</div>';

      // Simulate generation delay
      await new Promise(resolve => setTimeout(resolve, 1500));

      try {
        const response = await fetch('http://localhost:8000/api/generate-posts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            products: Array.from(selectedProducts),
            age_ranges: Array.from(selectedAges),
            interests: Array.from(selectedInterests),
            semantic_query: document.getElementById('semanticQuery').value
          })
        });

        if (!response.ok) {
          // Use local aesthetics data as fallback
          generatedPlacements = AESTHETICS;
          renderPlacements();
          document.getElementById('deployBtn').disabled = false;
        } else {
          const data = await response.json();
          generatedPlacements = data.posts || AESTHETICS;
          renderPlacements();
          document.getElementById('deployBtn').disabled = false;
        }

      } catch (error) {
        console.log('Using local aesthetics data');
        generatedPlacements = AESTHETICS;
        renderPlacements();
        document.getElementById('deployBtn').disabled = false;
      } finally {
        generateBtn.disabled = false;
        generateBtn.querySelector('span').textContent = originalText;
      }
    }

    // Render Placements
    function renderPlacements() {
      const container = document.getElementById('placementsContainer');

      if (generatedPlacements.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>No placements found</h3>
            <p>Try adjusting your targeting parameters</p>
          </div>
        `;
        return;
      }

      const grid = document.createElement('div');
      grid.className = 'placements-grid';
      grid.innerHTML = generatedPlacements.map((placement, index) => `
        <div class="placement-card ${placement.match >= 90 ? 'high-match' : ''}" data-index="${index}">
          <img src="${placement.img || placement.image_url}" alt="${placement.name}" loading="lazy">
          <div class="placement-card-info">
            <div class="placement-match">${placement.match || Math.floor(Math.random() * 20 + 75)}%</div>
            <div class="placement-name">${placement.name || 'Placement ' + (index + 1)}</div>
          </div>
        </div>
      `).join('');

      const summary = document.createElement('div');
      summary.className = 'placements-summary';
      summary.textContent = `${generatedPlacements.length} matches found`;

      container.innerHTML = '';
      container.appendChild(grid);
      container.appendChild(summary);

      // Add click handlers
      grid.querySelectorAll('.placement-card').forEach(card => {
        card.addEventListener('click', () => showModal(parseInt(card.dataset.index)));
      });
    }

    // Show Modal
    function showModal(index) {
      const placement = generatedPlacements[index];
      const modal = document.getElementById('modal');
      const comparisonGrid = document.getElementById('comparisonGrid');

      comparisonGrid.innerHTML = `
        <div class="comparison-item">
          <h3>Original Scene</h3>
          <img src="${placement.img || placement.image_url}" alt="Original">
        </div>
        <div class="comparison-item">
          <h3>With Product Placement</h3>
          <img src="${placement.placed_image_url || placement.img || placement.image_url}" alt="Placed">
        </div>
      `;

      modal.classList.add('active');
    }

    // Close Modal
    function closeModal() {
      document.getElementById('modal').classList.remove('active');
    }

    // Deploy
    async function deploy() {
      if (generatedPlacements.length === 0) {
        alert('No placements to deploy');
        return;
      }

      const deployBtn = document.getElementById('deployBtn');
      const originalText = deployBtn.querySelector('span').textContent;
      deployBtn.disabled = true;
      deployBtn.querySelector('span').textContent = 'Deploying...';

      try {
        const response = await fetch('http://localhost:8000/api/deploy', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            placements: generatedPlacements
          })
        });

        if (!response.ok) throw new Error('Deployment failed');

        alert('Campaign deployed successfully!');

      } catch (error) {
        console.error('Error:', error);
        alert(`Deployment simulated (backend not available)`);
      } finally {
        deployBtn.disabled = false;
        deployBtn.querySelector('span').textContent = originalText;
      }
    }

    // Event Listeners
    function setupEventListeners() {
      document.getElementById('generateBtn').addEventListener('click', generate);
      document.getElementById('deployBtn').addEventListener('click', deploy);
      document.getElementById('modalClose').addEventListener('click', closeModal);
      document.getElementById('modal').addEventListener('click', (e) => {
        if (e.target.id === 'modal') closeModal();
      });
    }

    // Initialize on load
    init();
  </script>
</body>
</html>
