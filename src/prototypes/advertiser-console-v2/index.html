<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advertiser Console - Test & Deploy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0f;
            color: #fff;
        }
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .glass-hover:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(251, 191, 36, 0.3);
        }
        .section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: #888;
            margin-bottom: 12px;
        }
        .tag {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s;
        }
        .tag:hover { border-color: rgba(251, 191, 36, 0.5); }
        .tag.active {
            background: #fbbf24;
            color: #000;
            border-color: #fbbf24;
        }
        .product-thumb {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }
        .product-thumb:hover { transform: scale(1.05); }
        .product-thumb.selected {
            border-color: #fbbf24;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.4);
        }
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #fbbf24;
            border-radius: 50%;
            cursor: pointer;
        }
        .test-card {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }
        .test-card:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        }
        .test-card img { width: 100%; aspect-ratio: 1; object-fit: cover; }
        .test-card .overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 50%);
            display: flex;
            align-items: flex-end;
            padding: 12px;
        }
        .match-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #22c55e;
            color: #000;
            font-size: 10px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .placement-preview {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            background: #111;
        }
        .placement-preview img { width: 100%; }
        .sponsored-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(251, 191, 36, 0.9);
            color: #000;
            font-size: 10px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 4px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(251, 191, 36, 0.3); }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.1); }
        textarea {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            padding: 12px;
            resize: none;
            width: 100%;
        }
        textarea:focus { outline: none; border-color: #fbbf24; }
        .scroll-y { overflow-y: auto; scrollbar-width: thin; scrollbar-color: #333 transparent; }
    </style>
</head>
<body class="h-screen flex">
    <!-- Left: Configuration Panel -->
    <div class="w-[400px] h-full glass border-r border-white/5 flex flex-col">
        <div class="p-6 border-b border-white/5">
            <h1 class="text-xl font-semibold">Campaign Setup</h1>
            <p class="text-sm text-gray-500 mt-1">Configure, test, and deploy</p>
        </div>

        <div class="flex-1 scroll-y p-6 space-y-8">
            <!-- A) Products -->
            <section>
                <div class="section-title">A) Products to Advertise</div>
                <div class="flex flex-wrap gap-3" id="productsGrid">
                    <!-- Filled by JS -->
                </div>
                <button class="btn-secondary mt-3 text-sm w-full">+ Upload Product Catalog</button>
            </section>

            <!-- B) Demographics -->
            <section>
                <div class="section-title">B) Target Demographics</div>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-gray-400 block mb-2">Age Range</label>
                        <div class="flex flex-wrap gap-2">
                            <button class="tag active" onclick="toggleTag(this)">18-24</button>
                            <button class="tag active" onclick="toggleTag(this)">25-34</button>
                            <button class="tag" onclick="toggleTag(this)">35-44</button>
                            <button class="tag" onclick="toggleTag(this)">45+</button>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 block mb-2">Interests</label>
                        <div class="flex flex-wrap gap-2">
                            <button class="tag active" onclick="toggleTag(this)">Fashion</button>
                            <button class="tag active" onclick="toggleTag(this)">Home</button>
                            <button class="tag" onclick="toggleTag(this)">Tech</button>
                            <button class="tag" onclick="toggleTag(this)">Wellness</button>
                            <button class="tag" onclick="toggleTag(this)">Travel</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- C) Image Match Criteria -->
            <section>
                <div class="section-title">C) Image Match Criteria</div>
                <p class="text-xs text-gray-500 mb-3">What type of user posts should your products appear in?</p>
                <div class="space-y-3">
                    <div>
                        <label class="text-xs text-gray-400 block mb-2">Scene Types</label>
                        <div class="flex flex-wrap gap-2">
                            <button class="tag active" onclick="toggleTag(this)">Interior</button>
                            <button class="tag active" onclick="toggleTag(this)">Lifestyle</button>
                            <button class="tag" onclick="toggleTag(this)">Outdoor</button>
                            <button class="tag" onclick="toggleTag(this)">Portrait</button>
                            <button class="tag" onclick="toggleTag(this)">Food</button>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 block mb-2">Aesthetic Vibes</label>
                        <div class="flex flex-wrap gap-2">
                            <button class="tag active" onclick="toggleTag(this)">Minimal</button>
                            <button class="tag" onclick="toggleTag(this)">Cozy</button>
                            <button class="tag active" onclick="toggleTag(this)">Modern</button>
                            <button class="tag" onclick="toggleTag(this)">Vintage</button>
                            <button class="tag" onclick="toggleTag(this)">Luxury</button>
                            <button class="tag" onclick="toggleTag(this)">Earthy</button>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 block mb-2">Custom Semantic Filter</label>
                        <textarea rows="2" placeholder="e.g. 'images with visible table surfaces, warm lighting, no faces'" id="semanticFilter"></textarea>
                    </div>
                </div>
            </section>

            <!-- D) Placement Prompt -->
            <section>
                <div class="section-title">D) Placement Instructions</div>
                <p class="text-xs text-gray-500 mb-3">How should products be placed in matched images?</p>
                <textarea rows="3" id="placementPrompt" placeholder="e.g. 'Place the product naturally on any visible surface, maintaining the scene's lighting and atmosphere'">Place the product naturally on a surface visible in the image. Match the lighting and shadows. The product should look like it belongs there.</textarea>
                <div class="flex flex-wrap gap-2 mt-3">
                    <button class="tag text-xs" onclick="setPromptPreset('subtle')">Subtle</button>
                    <button class="tag text-xs" onclick="setPromptPreset('prominent')">Prominent</button>
                    <button class="tag text-xs" onclick="setPromptPreset('editorial')">Editorial</button>
                    <button class="tag text-xs" onclick="setPromptPreset('in-use')">In-Use</button>
                </div>
            </section>

            <!-- E) Budget -->
            <section>
                <div class="section-title">E) Budget</div>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-2xl font-light">$<span id="budgetValue">500</span></span>
                    <span class="text-xs text-gray-500">per day</span>
                </div>
                <input type="range" min="50" max="5000" value="500" step="50" class="slider" oninput="updateBudget(this.value)">
                <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>$50</span>
                    <span>$5,000</span>
                </div>
                <div class="glass rounded-lg p-4 mt-4 space-y-2">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-400">Est. Daily Impressions</span>
                        <span id="estImpressions">12,500</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-400">Est. Cost per Placement</span>
                        <span id="estCPP">$0.04</span>
                    </div>
                </div>
            </section>
        </div>

        <!-- Deploy Button -->
        <div class="p-6 border-t border-white/5">
            <button class="btn-primary w-full" onclick="deployCampaign()">Deploy Campaign</button>
            <p class="text-xs text-gray-500 text-center mt-2">Campaign will go live immediately</p>
        </div>
    </div>

    <!-- Right: Test Area -->
    <div class="flex-1 h-full flex flex-col bg-[#0d0d12]">
        <!-- Header -->
        <div class="p-6 border-b border-white/5 flex justify-between items-center">
            <div>
                <h2 class="font-semibold">Test Placements</h2>
                <p class="text-sm text-gray-500">Preview how products appear in matched posts</p>
            </div>
            <div class="flex gap-3">
                <button class="btn-secondary text-sm" onclick="loadSamplePosts()">Load Sample Posts</button>
                <button class="btn-secondary text-sm" onclick="document.getElementById('uploadInput').click()">Upload Test Image</button>
                <input type="file" id="uploadInput" accept="image/*" hidden onchange="handleUpload(event)">
            </div>
        </div>

        <!-- Test Grid -->
        <div class="flex-1 p-6 scroll-y">
            <div class="grid grid-cols-3 gap-4" id="testGrid">
                <!-- Filled by JS -->
            </div>
        </div>

        <!-- Preview Modal (hidden by default) -->
        <div id="previewModal" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-8" onclick="closePreview()">
            <div class="max-w-5xl w-full grid grid-cols-2 gap-6" onclick="event.stopPropagation()">
                <div>
                    <div class="text-xs text-gray-500 mb-2">ORIGINAL POST</div>
                    <div class="placement-preview">
                        <img id="previewOriginal" src="" alt="Original">
                    </div>
                </div>
                <div>
                    <div class="text-xs text-gray-500 mb-2">WITH PRODUCT PLACEMENT</div>
                    <div class="placement-preview">
                        <img id="previewResult" src="" alt="Result">
                        <div class="sponsored-badge">SPONSORED</div>
                    </div>
                </div>
                <div class="col-span-2 flex justify-between items-center">
                    <div>
                        <span class="text-sm text-gray-400">Product: </span>
                        <span class="text-sm" id="previewProductName">Modern Desk Lamp</span>
                    </div>
                    <div class="flex gap-3">
                        <button class="btn-secondary" onclick="regeneratePlacement()">ðŸ”„ Regenerate</button>
                        <button class="btn-primary" onclick="approvePlacement()">âœ“ Approve</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Products catalog
        const products = [
            { id: 'lamp', name: 'Modern Desk Lamp', price: '$89', image: 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=200' },
            { id: 'vase', name: 'Ceramic Vase', price: '$45', image: 'https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=200' },
            { id: 'blanket', name: 'Wool Blanket', price: '$120', image: 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=200' },
            { id: 'book', name: 'Coffee Table Book', price: '$32', image: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=200' },
            { id: 'clock', name: 'Minimalist Clock', price: '$65', image: 'https://images.unsplash.com/photo-1563861826100-9cb868fdbe1c?w=200' },
            { id: 'candle', name: 'Scented Candle', price: '$28', image: 'https://images.unsplash.com/photo-1602874801006-e04291d9d6d3?w=200' },
        ];

        // Sample posts that could match
        const samplePosts = [
            { id: 1, image: 'https://images.unsplash.com/photo-1616046229478-9901c5536a45?w=600', match: 94 },
            { id: 2, image: 'https://images.unsplash.com/photo-1618220179428-22790b461013?w=600', match: 89 },
            { id: 3, image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=600', match: 87 },
            { id: 4, image: 'https://images.unsplash.com/photo-1615876234886-fd9a39fda97f?w=600', match: 82 },
            { id: 5, image: 'https://images.unsplash.com/photo-1595526114035-0d45ed16cfbf?w=600', match: 78 },
            { id: 6, image: 'https://images.unsplash.com/photo-1616594039964-ae9021a400a0?w=600', match: 75 },
        ];

        let selectedProducts = new Set(['lamp', 'vase']);

        // Initialize
        function init() {
            renderProducts();
            loadSamplePosts();
        }

        // Render products
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = products.map(p => `
                <img src="${p.image}"
                     alt="${p.name}"
                     title="${p.name} - ${p.price}"
                     class="product-thumb ${selectedProducts.has(p.id) ? 'selected' : ''}"
                     onclick="toggleProduct('${p.id}', this)">
            `).join('');
        }

        // Toggle product selection
        function toggleProduct(id, el) {
            if (selectedProducts.has(id)) {
                selectedProducts.delete(id);
                el.classList.remove('selected');
            } else {
                selectedProducts.add(id);
                el.classList.add('selected');
            }
        }

        // Toggle tag
        function toggleTag(el) {
            el.classList.toggle('active');
            updateEstimates();
        }

        // Set placement prompt preset
        function setPromptPreset(type) {
            const prompts = {
                'subtle': 'Place the product subtly in the background, partially visible. It should be discoverable but not obvious.',
                'prominent': 'Position the product prominently in the foreground as a key visual element.',
                'editorial': 'Place in an artistic, editorial style. The product should feel curated and intentional.',
                'in-use': 'Show the product being used or interacted with naturally in the scene.'
            };
            document.getElementById('placementPrompt').value = prompts[type] || '';
        }

        // Update budget
        function updateBudget(value) {
            document.getElementById('budgetValue').textContent = value;
            updateEstimates();
        }

        // Update estimates
        function updateEstimates() {
            const budget = parseInt(document.getElementById('budgetValue').textContent);
            const activeTags = document.querySelectorAll('.tag.active').length;
            const baseImpressions = budget * 25;
            const multiplier = 1 + (activeTags * 0.1);
            const impressions = Math.round(baseImpressions * multiplier);

            document.getElementById('estImpressions').textContent = impressions.toLocaleString();
            document.getElementById('estCPP').textContent = '$' + (budget / impressions).toFixed(2);
        }

        // Load sample posts
        function loadSamplePosts() {
            const grid = document.getElementById('testGrid');
            grid.innerHTML = samplePosts.map(post => `
                <div class="test-card glass" onclick="testPlacement(${post.id}, '${post.image}')">
                    <img src="${post.image}" alt="Sample post">
                    <div class="match-badge">${post.match}% match</div>
                    <div class="overlay">
                        <span class="text-sm">Click to test placement</span>
                    </div>
                </div>
            `).join('');
        }

        // Test placement on image
        function testPlacement(postId, imageUrl) {
            // Show modal
            document.getElementById('previewModal').classList.remove('hidden');
            document.getElementById('previewOriginal').src = imageUrl;
            // For demo, just show same image - in real app, this would call the API
            document.getElementById('previewResult').src = imageUrl;

            // Get selected product
            const productId = Array.from(selectedProducts)[0] || 'lamp';
            const product = products.find(p => p.id === productId);
            document.getElementById('previewProductName').textContent = product ? product.name : 'Product';
        }

        // Close preview
        function closePreview() {
            document.getElementById('previewModal').classList.add('hidden');
        }

        // Handle upload
        function handleUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                // Add to grid
                const grid = document.getElementById('testGrid');
                const card = document.createElement('div');
                card.className = 'test-card glass';
                card.innerHTML = `
                    <img src="${e.target.result}" alt="Uploaded">
                    <div class="match-badge">Custom</div>
                    <div class="overlay">
                        <span class="text-sm">Click to test placement</span>
                    </div>
                `;
                card.onclick = () => testPlacement(0, e.target.result);
                grid.prepend(card);
            };
            reader.readAsDataURL(file);
        }

        // Regenerate placement
        function regeneratePlacement() {
            alert('Regenerating with current settings...');
        }

        // Approve placement
        function approvePlacement() {
            alert('Placement approved! This style will be used in production.');
            closePreview();
        }

        // Deploy campaign
        function deployCampaign() {
            if (selectedProducts.size === 0) {
                alert('Please select at least one product');
                return;
            }

            const budget = document.getElementById('budgetValue').textContent;
            const prompt = document.getElementById('placementPrompt').value;
            const filter = document.getElementById('semanticFilter').value;

            alert(`Campaign Deployed!\n\nBudget: $${budget}/day\nProducts: ${selectedProducts.size}\nPlacement: "${prompt.substring(0, 50)}..."\n\nYour products will now appear in matching user posts.`);
        }

        // Init
        init();
    </script>
</body>
</html>
